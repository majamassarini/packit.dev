"use strict";(self.webpackChunkpackit_dev=self.webpackChunkpackit_dev||[]).push([[8088],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>g});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(a),d=r,g=u["".concat(s,".").concat(d)]||u[d]||m[d]||o;return a?n.createElement(g,i(i({ref:t},c),{},{components:a})):n.createElement(g,i({ref:t},c))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},49099:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const o={title:"Packit Service jobs configuration",date:new Date("2023-07-03T00:00:00.000Z"),sidebar_position:1},i="Packit Service jobs configuration",l={unversionedId:"configuration/jobs",id:"configuration/jobs",title:"Packit Service jobs configuration",description:"Packit Service doesn't have any web interface, but its behaviour can be configured via the config file",source:"@site/docs/configuration/jobs.md",sourceDirName:"configuration",slug:"/configuration/jobs",permalink:"/docs/configuration/jobs",draft:!1,editUrl:"https://github.com/packit/packit.dev/tree/main/docs/configuration/jobs.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Packit Service jobs configuration",date:"2023-07-03T00:00:00.000Z",sidebar_position:1},sidebar:"autogenerated",previous:{title:"Configuration",permalink:"/docs/configuration/"},next:{title:"Upstream jobs",permalink:"/docs/category/upstream-jobs"}},s={},p=[{value:"Configuration keys",id:"configuration-keys",level:2},{value:"job",id:"job",level:4},{value:"trigger",id:"trigger",level:4},{value:"packages",id:"packages",level:4},{value:"manual_trigger",id:"manual_trigger",level:4},{value:"Overriding global parameters in jobs",id:"overriding-global-parameters-in-jobs",level:3},{value:"Supported jobs",id:"supported-jobs",level:2}],c={toc:p},u="wrapper";function m(e){let{components:t,...a}=e;return(0,r.kt)(u,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"packit-service-jobs-configuration"},"Packit Service jobs configuration"),(0,r.kt)("p",null,"Packit Service doesn't have any web interface, but its behaviour can be configured via the config file\ngenerally described ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration"},"here"),"."),(0,r.kt)("p",null,"The tasks Packit Service should do should be defined in the ",(0,r.kt)("inlineCode",{parentName:"p"},"jobs")," section. The section is a list of dictionaries:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"jobs:\n- {key: value}\n- {}\n")),(0,r.kt)("p",null,"When there is an action (pull request, commit, etc.) in the upstream repository, Packit Service takes the config\nfile from the relevant git ref (release tag for release, PR head for pull requests, related dist-git commit for downstream jobs).\nThen, it tries to find a matching job in the ",(0,r.kt)("inlineCode",{parentName:"p"},"jobs")," sections for the particular event (e.g. for pull request, jobs with\n",(0,r.kt)("inlineCode",{parentName:"p"},"pull_request")," trigger are matched)."),(0,r.kt)("p",null,"If there is no ",(0,r.kt)("inlineCode",{parentName:"p"},"jobs")," section in the configuration file, jobs default to:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"jobs:\n- job: copr_build\n  trigger: pull_request\n  targets: [fedora-stable]\n\n- job: tests\n  trigger: pull_request\n  targets: [fedora-stable]\n\n- job: propose_downstream\n  trigger: release\n  dist_git_branches:\n    - fedora-all\n")),(0,r.kt)("p",null,"If you do not want to use the jobs then the ",(0,r.kt)("inlineCode",{parentName:"p"},"jobs")," section in the configuration file should be empty:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"jobs: []\n\n")),(0,r.kt)("p",null,"Packit configuration supports ",(0,r.kt)("a",{parentName:"p",href:"https://yaml.org/type/merge.html"},"YAML Merge Key syntax"),", which can be used to reduce duplication of configuration. Please see the example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# before\njobs:\n- job: copr_build\n\xa0 trigger: pull_request\n\xa0 targets:\n\xa0 - centos-stream-8-x86_64\n\xa0 - centos-stream-9-x86_64\n\xa0 - fedora-all\n\n- job: copr_build\n\xa0 trigger: commit\n\xa0 branch: main\n\xa0 targets:\n\xa0 - centos-stream-8-x86_64\n\xa0 - centos-stream-9-x86_64\n\xa0 - fedora-all\n\n# after\njobs:\n- &copr\n\xa0 job: copr_build\n\xa0 trigger: pull_request\n\xa0 targets:\n\xa0 - centos-stream-8-x86_64\n\xa0 - centos-stream-9-x86_64\n\xa0 - fedora-all\n\n- <<: *copr\n\xa0 trigger: commit\n\xa0 branch: main\n")),(0,r.kt)("h2",{id:"configuration-keys"},"Configuration keys"),(0,r.kt)("h4",{id:"job"},"job"),(0,r.kt)("p",null,"(",(0,r.kt)("em",{parentName:"p"},"str"),") name of the job (you can imagine this as a CLI command)."),(0,r.kt)("h4",{id:"trigger"},"trigger"),(0,r.kt)("p",null,"(",(0,r.kt)("em",{parentName:"p"},"str"),") what is the trigger for the job? Every job only supports a specific set of triggers."),(0,r.kt)("h4",{id:"packages"},"packages"),(0,r.kt)("p",null,"(",(0,r.kt)("em",{parentName:"p"},"list"),") Optional, list of package object names (when using monorepositories). If a job object has no such key,\nall packages of a monorepo should be handled. The package object names need to be defined\nin the ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration#packages"},(0,r.kt)("inlineCode",{parentName:"a"},"packages"))," dictionary."),(0,r.kt)("p",null,"Here is an example of the configuration of the job including the ",(0,r.kt)("inlineCode",{parentName:"p"},"packages"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"jobs:\n  - job: copr_build\n    trigger: pull_request\n    targets:\n      - fedora-all\n      - epel-8\n    packages:\n      - copr-frontend\n      - copr-backend\n")),(0,r.kt)("h4",{id:"manual_trigger"},"manual_trigger"),(0,r.kt)("p",null,"(",(0,r.kt)("em",{parentName:"p"},"bool"),") Option that enables triggering the job only manually (via pull-request/issue comment or rerunning GitHub check).\nDefaults to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),"."),(0,r.kt)("h3",{id:"overriding-global-parameters-in-jobs"},"Overriding global parameters in jobs"),(0,r.kt)("p",null,"You are able to override your global parameters (such as ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration#specfile_path"},(0,r.kt)("inlineCode",{parentName:"a"},"specfile_path")),",\n",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration#downstream_package_name"},(0,r.kt)("inlineCode",{parentName:"a"},"downstream_package_name")),",\n",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration/actions"},(0,r.kt)("inlineCode",{parentName:"a"},"actions")),"...) for every job. This is very useful\nwhen you want to set up a build or a test matrix using different parameters or\nconfiguration. It's also useful when your release workflow differs between\nFedora and EPEL."),(0,r.kt)("p",null,"In order to do such a thing, just set a value you want to override in the\nrespective job."),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"specfile_path: package.spec\njobs:\n- job: some-job\n  trigger: ran-out-of-beer\n  targets: [fedora-stable]\n  specfile_path: somewhere/else/package.spec\n")),(0,r.kt)("p",null,"In this example, the job ",(0,r.kt)("inlineCode",{parentName:"p"},"some-job")," would override ",(0,r.kt)("a",{parentName:"p",href:"/docs/configuration#specfile_path"},(0,r.kt)("inlineCode",{parentName:"a"},"specfile_path"))," to\n",(0,r.kt)("inlineCode",{parentName:"p"},"somewhere/else/package.spec")," instead of using ",(0,r.kt)("inlineCode",{parentName:"p"},"./package.spec"),"."),(0,r.kt)("h2",{id:"supported-jobs"},"Supported jobs"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Upstream jobs",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"upstream/copr_build"},(0,r.kt)("inlineCode",{parentName:"a"},"copr_build"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"upstream/tests"},(0,r.kt)("inlineCode",{parentName:"a"},"tests"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"upstream/upstream_koji_build"},(0,r.kt)("inlineCode",{parentName:"a"},"upstream_koji_build"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"upstream/vm_image_build"},(0,r.kt)("inlineCode",{parentName:"a"},"vm_image_build"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"upstream/propose_downstream"},(0,r.kt)("inlineCode",{parentName:"a"},"propose_downstream"))))),(0,r.kt)("li",{parentName:"ul"},"Downstream jobs",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"downstream/pull_from_upstream"},(0,r.kt)("inlineCode",{parentName:"a"},"pull_from_upstream"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"downstream/koji_build"},(0,r.kt)("inlineCode",{parentName:"a"},"koji_build"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"downstream/bodhi_update"},(0,r.kt)("inlineCode",{parentName:"a"},"bodhi_update")))))))}m.isMDXComponent=!0}}]);