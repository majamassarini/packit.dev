"use strict";(self.webpackChunkpackit_dev=self.webpackChunkpackit_dev||[]).push([[5780],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=l(n),m=r,g=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?a.createElement(g,i(i({ref:t},c),{},{components:n})):a.createElement(g,i({ref:t},c))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p[d]="string"==typeof e?e:r,i[1]=p;for(var l=2;l<o;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},35210:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>p,toc:()=>l});var a=n(87462),r=(n(67294),n(3905));const o={title:"PostgreSQL"},i="Logs",p={unversionedId:"postgresql",id:"postgresql",title:"PostgreSQL",description:"See /var/lib/pgsql/data/userdata/log/postgresql-*.log in the pod's Terminal.",source:"@site/deployment/postgresql.md",sourceDirName:".",slug:"/postgresql",permalink:"/deployment/postgresql",draft:!1,editUrl:"https://github.com/packit/deployment/tree/main/docs/deployment/postgresql.md",tags:[],version:"current",frontMatter:{title:"PostgreSQL"},sidebar:"autogenerated",previous:{title:"Deploy Packit Service on Openshift Local Cluster",permalink:"/deployment/openshift_local_cluster"},next:{title:"Updating the changelog",permalink:"/deployment/scripts"}},s={},l=[{value:"What&#39;s inside, ER Diagram, backups",id:"whats-inside-er-diagram-backups",level:2},{value:"Move data to another instance",id:"move-data-to-another-instance",level:2},{value:"Upgrade",id:"upgrade",level:2}],c={toc:l},d="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"logs"},"Logs"),(0,r.kt)("p",null,"See ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/lib/pgsql/data/userdata/log/postgresql-*.log")," in the pod's Terminal."),(0,r.kt)("h1",{id:"data"},"Data"),(0,r.kt)("h2",{id:"whats-inside-er-diagram-backups"},"What's inside, ER Diagram, backups"),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/packit/packit-service/tree/main/docs/database"},"https://github.com/packit/packit-service/tree/main/docs/database")),(0,r.kt)("h2",{id:"move-data-to-another-instance"},"Move data to another instance"),(0,r.kt)("p",null,"To write out the data from the database ",(0,r.kt)("inlineCode",{parentName:"p"},"pg_dump packit")," can be used.\nThe command creates a file with SQL commands for restoring the database.\nTo import the data ",(0,r.kt)("inlineCode",{parentName:"p"},"psql")," command can be used."),(0,r.kt)("h2",{id:"upgrade"},"Upgrade"),(0,r.kt)("p",null,"When upgrading the database between major versions, the data can be incompatible with the new version."),(0,r.kt)("p",null,"We run Postgres in an Openshift pod, so the process to migrate the data can be to create a new pod (it is important to also\nuse a new PVC in this pod) and then dump the data from the old pod and import them to the new pod:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ oc exec old-postgres-pod -- pg_dumpall -U postgres > dump\n$ oc exec -it new-postgres-pod -- psql -U postgres < dump\n")),(0,r.kt)("p",null,"Or see instructions in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/packit/packit-service/tree/main/docs/database#using-live-data-locally"},"https://github.com/packit/packit-service/tree/main/docs/database#using-live-data-locally")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"postgres")," service then needs to be linked to the new pod and the old pod and PVC can be deleted."))}u.isMDXComponent=!0}}]);