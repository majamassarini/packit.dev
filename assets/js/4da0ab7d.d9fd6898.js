"use strict";(self.webpackChunkpackit_dev=self.webpackChunkpackit_dev||[]).push([[7742],{3905:(e,t,i)=>{i.d(t,{Zo:()=>d,kt:()=>g});var a=i(67294);function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e,t){if(null==e)return{};var i,a,n=function(e,t){if(null==e)return{};var i,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var u=a.createContext({}),c=function(e){var t=a.useContext(u),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},d=function(e){var t=c(e.components);return a.createElement(u.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},s=a.forwardRef((function(e,t){var i=e.components,n=e.mdxType,r=e.originalType,u=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=c(i),s=n,g=m["".concat(u,".").concat(s)]||m[s]||p[s]||r;return i?a.createElement(g,o(o({ref:t},d),{},{components:i})):a.createElement(g,o({ref:t},d))}));function g(e,t){var i=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=i.length,o=new Array(r);o[0]=s;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l[m]="string"==typeof e?e:n,o[1]=l;for(var c=2;c<r;c++)o[c]=i[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,i)}s.displayName="MDXCreateElement"},72733:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var a=i(87462),n=(i(67294),i(3905));const r={title:"in-image-builder",date:new Date("2022-10-19T23:00:00.000Z"),sidebar_position:25},o="packit build in-image-builder",l={unversionedId:"cli/build/in-image-builder",id:"cli/build/in-image-builder",title:"in-image-builder",description:'Create a VM image in Image Builder defined in your "packit.yaml" using your Copr builds.',source:"@site/docs/cli/build/in-image-builder.md",sourceDirName:"cli/build",slug:"/cli/build/in-image-builder",permalink:"/docs/cli/build/in-image-builder",draft:!1,editUrl:"https://github.com/packit/packit.dev/tree/main/docs/cli/build/in-image-builder.md",tags:[],version:"current",sidebarPosition:25,frontMatter:{title:"in-image-builder",date:"2022-10-19T23:00:00.000Z",sidebar_position:25},sidebar:"autogenerated",previous:{title:"in-koji",permalink:"/docs/cli/build/koji"},next:{title:"locally",permalink:"/docs/cli/build/local"}},u={},c=[{value:"Requirements",id:"requirements",level:2},{value:"Tutorial",id:"tutorial",level:2},{value:"Help",id:"help",level:2}],d={toc:c},m="wrapper";function p(e){let{components:t,...i}=e;return(0,n.kt)(m,(0,a.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"packit-build-in-image-builder"},(0,n.kt)("inlineCode",{parentName:"h1"},"packit build in-image-builder")),(0,n.kt)("p",null,'Create a VM image in Image Builder defined in your "packit.yaml" using your Copr builds.'),(0,n.kt)("h2",{id:"requirements"},"Requirements"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Be familiar with Red Hat Image Builder:",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://www.redhat.com/en/blog/using-hosted-image-builder-its-api"},"https://www.redhat.com/en/blog/using-hosted-image-builder-its-api")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://console.redhat.com/docs/api/image-builder"},"https://console.redhat.com/docs/api/image-builder")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/composing_a_customized_rhel_system_image/index"},"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/composing_a_customized_rhel_system_image/index")))),(0,n.kt)("li",{parentName:"ul"},"Red Hat API token set as ",(0,n.kt)("inlineCode",{parentName:"li"},"redhat_api_refresh_token")," in ",(0,n.kt)("inlineCode",{parentName:"li"},"~/.config/packit.yaml"),"; the token can be obtained ",(0,n.kt)("a",{parentName:"li",href:"https://access.redhat.com/management/api"},"here")),(0,n.kt)("li",{parentName:"ul"},"Packit config with a ",(0,n.kt)("inlineCode",{parentName:"li"},"vm_image_build")," job defined")),(0,n.kt)("h2",{id:"tutorial"},"Tutorial"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"/docs/configuration/"},"Place a config file for packit in the root of your upstream repository."))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Add a ",(0,n.kt)("a",{parentName:"p",href:"/docs/configuration/upstream/vm_image_build"},(0,n.kt)("inlineCode",{parentName:"a"},"vm_image_build")," job"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Submit a request to Red Hat Image Builder:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre"},"$ cd my/ustream/project/\n$ packit build in-image-builder my-new-fancy-image\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Navigate to the ",(0,n.kt)("a",{parentName:"p",href:"https://console.redhat.com/insights/image-builder"},"Image Builder web interface")," to use your image once the build is complete."))),(0,n.kt)("p",null,"As of December 2022, Packit Github app can now submit builds to Red Hat Image\nBuilder, for more details see the ",(0,n.kt)("inlineCode",{parentName:"p"},"vm_image_build")," job description."),(0,n.kt)("h2",{id:"help"},"Help"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"Usage: packit build in-image-builder [OPTIONS] IMAGE_NAME [PATH_OR_URL]\n\n  Create a VM image in Image Builder.\n\n  ### EXPERIMENTAL ###\n\n  This command is experimental and the integration with Image Builder will be\n  changed in a backwards incompatible way in the future.\n\n  Packit loads image build configuration from your packit.yaml file.\n\n  When `--job-config-index` is not specified, the job configuration is loaded\n  from your .packit.yaml and the first matching vm_image_build job is used.\n\n  IMAGE_NAME is the name of the image to be created. Please pick something\n  unique so it's easy to identify for you in the Image Builder interface and\n  can be well associated with the image content.\n\n  [PATH_OR_URL] argument is a local path or a URL to the upstream git\n  repository, it defaults to the current working directory\n\nOptions:\n  --job-config-index INTEGER  Use N-th job definition to load configuration\n                              for the image build. The type needs to be\n                              vm_image_build.\n  --wait / --no-wait          Wait for the build to finish\n  -p, --package TEXT          Package to build, if more than one available,\n                              like in a monorepo configuration. Use it\n                              multiple times to select multiple\n                              packages.Defaults to all the packages listed\n                              inside the config.\n  -h, --help                  Show this message and exit.\n")))}p.isMDXComponent=!0}}]);